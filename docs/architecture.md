# 專案架構 (Project Architecture)

本文件概述了應用的高階架構，遵循以「功能切片 (Feature Slices)」為核心的模組化設計哲學。

## 1. 核心理念：功能切片 (Feature Slices)

為了實現高內聚、低耦合，我們將應用程式拆分為職責分明的功能切片，它們都位於 `src/features/` 目錄下：

1.  **`features/core/` (核心切片)**:
    *   **職責**: 管理應用的**身份與上下文**。這包括用戶身份驗證 (`auth`) 和帳戶/組織的上下文管理 (`account`)。
    *   **原則**: 這是應用的「我是誰」和「我在哪」的控制中心。

2.  **`features/layout/` (佈局切片)**:
    *   **職責**: 管理應用的**全局介面外殼**。這包括主側邊欄 (`Sidebar`) 和頁頭 (`Header`) 的具體實現，它們透過 Next.js 的平行路由 (`@sidebar`, `@header`) 被渲染。
    *   **原則**: 這決定了應用的「外觀」。

3.  **`features/workspaces/` (工作區切片)**:
    *   **職責**: 管理所有與「工作區」相關的業務邏輯。這包括工作區的列表、創建、以及單一工作區的「容器 (Shell)」。最重要的是，它定義並實現了所有可插拔的「能力 (Capabilities)」。
    *   **原則**: 這是應用的「業務內容區」，提供了所有核心的業務價值。

## 2. 三大邏輯平面 (Logical Planes)

在 `workspaces` 功能切片內部，我們進一步將「能力」劃分為邏輯上的三個平面：

1.  **治理控制平面 (Control Plane)**:
    *   **職責**: 管理和監控工作區的「規則」與狀態。
    *   **範例**: `Settings`, `Members`, `Audit`。

2.  **業務能力平面 (Runtime Plane)**:
    *   **職責**: 執行具體的業務價值，是使用者的主要生產力工具。
    *   **範例**: `Tasks`, `Files`, `Finance`, `Schedule`。

3.  **基礎設施層 (Infrastructure)**:
    *   **職責**: 提供跨平面通訊的解耦機制，其核心是與每個工作區實例綁定的**事件總線 (Event Bus)**。
    *   **原則**: 任何跨能力的交互都必須透過事件總線進行，嚴禁直接導入。

## 3. 目錄結構概覽

```text
src/
├── app/         # Next.js 路由層 (僅負責路由與平行路由插槽)
└── features/    # 所有業務邏輯的核心
    ├── core/      # 【核心】身份、帳戶
    ├── layout/    # 【佈局】側邊欄、頁頭
    └── workspaces/# 【工作區】容器與所有能力
```

這種結構確保了職責的清晰分離，並使系統易於維護和擴展。
